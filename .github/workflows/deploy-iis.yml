name: Deploy Static Website to IIS

# Trigger workflow on push to main branch
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to IIS
    runs-on: self-hosted  # uses your self-hosted runner on the IIS server

    steps:
      # Step 1: Checkout your repository
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Step 2: Deploy files to IIS
      - name: Deploy to IIS
        run: |
          $webRoot = "C:\inetpub\wwwroot"

          # Remove existing files
          Remove-Item "$webRoot\*" -Recurse -Force

          # Copy new files from the repo
          Copy-Item -Path "${{ github.workspace }}\*" -Destination $webRoot -Recurse -Force

          Write-Host "Files deployed successfully."

      # Step 3 (Optional): Restart IIS if needed
      - name: Restart IIS
        if: always()
        run: |
          Write-Host "Restarting IIS..."
          iisreset
