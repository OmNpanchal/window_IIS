name: Deploy Website to IIS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Deploy to IIS
        shell: powershell
        run: |
          $source = $PWD
          $destination = "C:\inetpub\wwwroot"

          Write-Host "Source: $source"
          Write-Host "Destination: $destination"

          robocopy $source $destination /MIR /XD ".git" ".github"

          # robocopy success codes: 0â€“3
          if ($LastExitCode -le 3) {
            Write-Host "Robocopy Success (ExitCode=$LastExitCode)"
            exit 0
          } else {
            Write-Host "Robocopy Failed (ExitCode=$LastExitCode)"
            exit $LastExitCode
          }

      - name: Restart IIS
        shell: powershell
        run: iisreset
