name: Deploy Static Website to IIS

# Trigger workflow on push to main branch
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to IIS
    runs-on: self-hosted  # uses your self-hosted runner on IIS

    steps:
      # Step 1: Checkout repository using Git
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # fetch full history

      # Step 2: Deploy files to IIS
      - name: Deploy to IIS
        run: |
          $webRoot = "C:\inetpub\wwwroot"

          # Remove existing files
          if (Test-Path $webRoot) {
              Remove-Item "$webRoot\*" -Recurse -Force
          }

          # Copy new files from the repository
          Copy-Item -Path "${{ github.workspace }}\*" -Destination $webRoot -Recurse -Force

          Write-Host "Files deployed successfully. IIS restart is not required for static HTML."

      # Optional: If you ever need to restart IIS and the runner runs as Administrator
      #- name: Restart IIS
      #  run: |
      #    Write-Host "Restarting IIS..."
      #    iisreset
